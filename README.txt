Shifting trees

Google codejam 2012
Finals
Problem E
